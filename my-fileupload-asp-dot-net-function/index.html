
<!DOCTYPE HTML>
<html>
<head>
	<script data-cfasync="false" type="text/javascript" src="//use.typekit.net/axj3cfp.js"></script>
	<script data-cfasync="false" type="text/javascript">try{Typekit.load();}catch(e){}</script>
	<meta charset="utf-8">
	<title>My FileUpload ASP.NET function  | Ross Lancaster</title>

<meta name="author" content="Ross Lancaster"> 

<meta name="description" content="I’m making a website for my family reunion. I found a couple good sites that had some examples of ASP.NET’s FileUpload control, but I’m going to post &hellip;"> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="http://feeds.feedburner.com/toastymallows" rel="alternate" title="Ross Lancaster" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css" media="screen" />
<script type="text/javascript" src="/fancybox/jquery.fancybox.pack.js"></script>

<script language="Javascript" type="text/javascript">
$(document).ready(
  function() {
    (function($) {
      $(".fancybox[data-content-id]").each(function() {
        this.href = $(this).data('content-id');
      });
      $(".fancybox").fancybox({
        beforeLoad: function() {
          var el, 
              id = $(this.element).data('title-id');

          if (id) {
            el = $('#' + id);

            if (el.length) {
              this.title = el.html();
            }
          }
          if ($(this).data('content')) {
            this.content = $(this).data('content');
          }
        },
        helpers: {
          title: {
            type: 'inside'
          }
        }
      });
    })(jQuery);
  }
);
</script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Ross Lancaster</a></h1>
<h4>&#35;define blog</h4>
<nav id="main-nav"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/about">About</a></li>
	<li><a href="/portfolio">Portfolio</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/about">About</a></li>
	<li><a href="/portfolio">Portfolio</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:ToastyMallows.github.io">
			</form>
		</div>
	</div>
</nav>


</header>

	<div id="content" class="inner"><article class="post">
	<h2 class="title">My FileUpload ASP.NET Function</h2>
	<div class="entry-content"><p>I’m making a website for my family reunion.  I found a couple good sites that had some examples of ASP.NET’s FileUpload control, but I’m going to post mine here so that anyone that finds it useful can use it. I’m using Visual Studio 2012 and ASP.NET 4.5.</p>

<p>I wanted to be able to have the family upload files and I wanted to have them automatically sorted by what year we had the reunion, and by content type.  That would make it easier for me to set up ASP.NET membership security on the whole folder so that anonymous requested couldn’t view the content.  It was also be easier to display the content later.</p>

<!--more-->

<p>Front-end:</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="aspx-cs"><span class="line"><span class="nt">&lt;asp:FileUpload</span> <span class="na">ID=</span><span class="s">&quot;FileUploadControl&quot;</span> <span class="na">runat=</span><span class="s">&quot;server&quot;</span> <span class="na">AllowMultiple=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
</span><span class="line">
</span><span class="line"><span class="nt">&lt;asp:Button</span> <span class="na">runat=</span><span class="s">&quot;server&quot;</span> <span class="na">ID=</span><span class="s">&quot;UploadButton&quot;</span> <span class="na">OnClick=</span><span class="s">&quot;UploadButton_Click&quot;</span> <span class="na">Text=</span><span class="s">&quot;Upload&quot;</span><span class="nt">/&gt;</span>
</span><span class="line">
</span><span class="line"><span class="nt">&lt;asp:DropDownList</span> <span class="na">runat=</span><span class="s">&quot;server&quot;</span> <span class="na">ID=</span><span class="s">&quot;reunionYears&quot;</span> <span class="na">AutoPostBack=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;&lt;/asp:DropDownList&gt;</span>
</span><span class="line">
</span><span class="line"><span class="nt">&lt;asp:Label</span> <span class="na">runat=</span><span class="s">&quot;server&quot;</span> <span class="na">ID=</span><span class="s">&quot;StatusLabel&quot;</span> <span class="na">CssClass=</span><span class="s">&quot;uploadStatus&quot;</span> <span class="na">Text=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;&lt;/asp:Label&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Code-behind:</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
</pre></td><td class="code"><pre><code class="csharp"><span class="line"><span class="k">protected</span> <span class="k">void</span> <span class="nf">UploadButton_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">	<span class="kt">bool</span> <span class="n">success</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class="line">
</span><span class="line">	<span class="k">if</span> <span class="p">(</span><span class="n">FileUploadControl</span><span class="p">.</span><span class="n">HasFile</span><span class="p">)</span>
</span><span class="line">	<span class="p">{</span>
</span><span class="line">	    <span class="k">try</span>
</span><span class="line">	    <span class="p">{</span>
</span><span class="line">		<span class="k">foreach</span> <span class="p">(</span><span class="n">HttpPostedFile</span> <span class="n">file</span> <span class="k">in</span> <span class="n">FileUploadControl</span><span class="p">.</span><span class="n">PostedFiles</span><span class="p">)</span>
</span><span class="line">		<span class="p">{</span>
</span><span class="line">		    <span class="kt">string</span> <span class="n">content</span> <span class="p">=</span> <span class="n">file</span><span class="p">.</span><span class="n">ContentType</span><span class="p">;</span>
</span><span class="line">		    <span class="kt">string</span> <span class="n">filename</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">GetFileNameWithoutExtension</span><span class="p">(</span><span class="n">file</span><span class="p">.</span><span class="n">FileName</span><span class="p">);</span>
</span><span class="line">		    <span class="kt">string</span> <span class="n">extension</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">GetExtension</span><span class="p">(</span><span class="n">file</span><span class="p">.</span><span class="n">FileName</span><span class="p">);</span>
</span><span class="line">		    <span class="kt">string</span> <span class="n">folderName</span> <span class="p">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
</span><span class="line">
</span><span class="line">		    <span class="k">if</span> <span class="p">(</span><span class="n">content</span> <span class="p">==</span> <span class="s">&quot;image/jpeg&quot;</span> <span class="p">||</span> <span class="n">content</span> <span class="p">==</span> <span class="s">&quot;image/pjpeg&quot;</span> <span class="p">||</span> <span class="n">content</span> <span class="p">==</span> <span class="s">&quot;image/png&quot;</span> <span class="p">||</span> <span class="n">content</span> <span class="p">==</span> <span class="s">&quot;image/tiff&quot;</span> <span class="p">||</span> <span class="n">content</span> <span class="p">==</span> <span class="s">&quot;image/gif&quot;</span> <span class="p">||</span> <span class="n">content</span> <span class="p">==</span> <span class="s">&quot;image/bmp&quot;</span><span class="p">)</span>
</span><span class="line">		    <span class="p">{</span>
</span><span class="line">			<span class="n">folderName</span> <span class="p">=</span> <span class="s">&quot;Images&quot;</span><span class="p">;</span>
</span><span class="line">		    <span class="p">}</span>
</span><span class="line">		    <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">content</span> <span class="p">==</span> <span class="s">&quot;text/plain&quot;</span> <span class="p">||</span> <span class="n">content</span> <span class="p">==</span> <span class="s">&quot;text/html&quot;</span> <span class="p">||</span> <span class="n">content</span> <span class="p">==</span> <span class="s">&quot;application/pdf&quot;</span> <span class="p">||</span> <span class="n">content</span> <span class="p">==</span> <span class="s">&quot;application/rtf&quot;</span> <span class="p">||</span> <span class="n">content</span> <span class="p">==</span> <span class="s">&quot;application/msword&quot;</span> <span class="p">||</span> <span class="n">content</span><span class="p">==</span><span class="s">&quot;application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot;</span><span class="p">)</span>
</span><span class="line">		    <span class="p">{</span>
</span><span class="line">			<span class="n">folderName</span> <span class="p">=</span> <span class="s">&quot;Text&quot;</span><span class="p">;</span>
</span><span class="line">		    <span class="p">}</span>
</span><span class="line">		    <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">content</span> <span class="p">==</span> <span class="s">&quot;video/mp4&quot;</span> <span class="p">||</span> <span class="n">content</span> <span class="p">==</span> <span class="s">&quot;video/mpeg&quot;</span> <span class="p">||</span> <span class="n">content</span> <span class="p">==</span> <span class="s">&quot;video/x-msvideo&quot;</span> <span class="p">||</span> <span class="n">content</span> <span class="p">==</span> <span class="s">&quot;video/quicktime&quot;</span><span class="p">)</span>
</span><span class="line">		    <span class="p">{</span>
</span><span class="line">			<span class="n">folderName</span> <span class="p">=</span> <span class="s">&quot;Video&quot;</span><span class="p">;</span>
</span><span class="line">		    <span class="p">}</span>
</span><span class="line">		    <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">content</span> <span class="p">==</span> <span class="s">&quot;audio/mpeg&quot;</span> <span class="p">||</span> <span class="n">content</span> <span class="p">==</span> <span class="s">&quot;audio/ogg&quot;</span> <span class="p">||</span> <span class="n">content</span> <span class="p">==</span> <span class="s">&quot;audio/x-wav&quot;</span> <span class="p">||</span> <span class="n">content</span> <span class="p">==</span> <span class="s">&quot;audio/x-ms-wma&quot;</span> <span class="p">||</span> <span class="n">content</span> <span class="p">==</span> <span class="s">&quot;audio/x-aac&quot;</span><span class="p">)</span>
</span><span class="line">		    <span class="p">{</span>
</span><span class="line">			<span class="n">folderName</span> <span class="p">=</span> <span class="s">&quot;Audio&quot;</span><span class="p">;</span>
</span><span class="line">		    <span class="p">}</span>
</span><span class="line">		    <span class="k">else</span>
</span><span class="line">		    <span class="p">{</span>
</span><span class="line">			<span class="n">StatusLabel</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="s">&quot;Upload status: Failed!  Unsupported format &#39;&quot;</span> <span class="p">+</span> <span class="n">content</span> <span class="p">+</span> <span class="s">&quot;&#39;&quot;</span><span class="p">;</span>
</span><span class="line">			<span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">();</span>
</span><span class="line">			<span class="c1">//goes to catch on any failure</span>
</span><span class="line">		    <span class="p">}</span>
</span><span class="line">
</span><span class="line">		    <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">&quot;~/Content/ReunionContent/&quot;</span> <span class="p">+</span> <span class="n">reunionYears</span><span class="p">.</span><span class="n">SelectedValue</span> <span class="p">+</span> <span class="s">&quot;/&quot;</span> <span class="p">+</span> <span class="n">folderName</span><span class="p">;</span>
</span><span class="line">		    <span class="k">if</span> <span class="p">(!</span><span class="n">Directory</span><span class="p">.</span><span class="n">Exists</span><span class="p">(</span><span class="n">Server</span><span class="p">.</span><span class="n">MapPath</span><span class="p">(</span><span class="n">path</span><span class="p">)))</span>
</span><span class="line">		    <span class="p">{</span>
</span><span class="line">			<span class="n">Directory</span><span class="p">.</span><span class="n">CreateDirectory</span><span class="p">(</span><span class="n">Server</span><span class="p">.</span><span class="n">MapPath</span><span class="p">(</span><span class="n">path</span><span class="p">));</span>
</span><span class="line">		    <span class="p">}</span>
</span><span class="line">
</span><span class="line">		    <span class="n">path</span> <span class="p">+=</span> <span class="s">&quot;/&quot;</span> <span class="p">+</span> <span class="n">filename</span><span class="p">;</span>
</span><span class="line">
</span><span class="line">		    <span class="kt">string</span> <span class="n">makeFileUnique</span> <span class="p">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
</span><span class="line">		    <span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
</span><span class="line">
</span><span class="line">		    <span class="k">while</span> <span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">File</span><span class="p">.</span><span class="n">Exists</span><span class="p">(</span><span class="n">Server</span><span class="p">.</span><span class="n">MapPath</span><span class="p">(</span><span class="n">path</span> <span class="p">+</span> <span class="n">makeFileUnique</span> <span class="p">+</span> <span class="n">extension</span><span class="p">)))</span>
</span><span class="line">		    <span class="p">{</span>
</span><span class="line">			<span class="n">makeFileUnique</span> <span class="p">=</span> <span class="s">&quot;-&quot;</span> <span class="p">+</span> <span class="n">i</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span>
</span><span class="line">			<span class="n">i</span><span class="p">++;</span>
</span><span class="line">		    <span class="p">}</span>
</span><span class="line">
</span><span class="line">		    <span class="c1">//makeFileUnique could be empty string on first upload</span>
</span><span class="line">		    <span class="n">path</span> <span class="p">+=</span> <span class="n">makeFileUnique</span> <span class="p">+</span> <span class="n">extension</span><span class="p">;</span>
</span><span class="line">
</span><span class="line">		    <span class="c1">//this actually &quot;uploads&quot; the file to the server path</span>
</span><span class="line">		    <span class="n">FileUploadControl</span><span class="p">.</span><span class="n">SaveAs</span><span class="p">(</span><span class="n">Server</span><span class="p">.</span><span class="n">MapPath</span><span class="p">(</span><span class="n">path</span><span class="p">));</span>
</span><span class="line">		<span class="p">}</span>
</span><span class="line">		<span class="n">success</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class="line">	    <span class="p">}</span>
</span><span class="line">	    <span class="k">catch</span>
</span><span class="line">	    <span class="p">{</span>
</span><span class="line">		<span class="n">success</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class="line">	    <span class="p">}</span>
</span><span class="line">	    <span class="k">finally</span>
</span><span class="line">	    <span class="p">{</span>
</span><span class="line">		<span class="k">if</span> <span class="p">(</span><span class="n">success</span><span class="p">)</span>
</span><span class="line">		<span class="p">{</span>
</span><span class="line">		    <span class="n">StatusLabel</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="s">&quot;Upload status: Success!&quot;</span><span class="p">;</span>
</span><span class="line">		<span class="p">}</span>
</span><span class="line">	    <span class="p">}</span>
</span><span class="line">	<span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Feel free to use this code on your website!  I imagine you’ll need to tweak it a bit though :)
Happy coding!</p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-12-23T18:29:00-05:00" pubdate data-updated="true">23 December 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/asp-dot-net/'>ASP.NET</a>, <a class='category' href='/blog/categories/microsoft/'>Microsoft</a>, <a class='category' href='/blog/categories/upload/'>upload</a>, <a class='category' href='/blog/categories/webdev/'>webdev</a>


</div>
	
</div></article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	
<!---	<a class="addthis_counter addthis_pill_style"></a> --->
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


</div>
	<footer id="footer" class="inner">Copyright &copy; 2015

    Ross Lancaster

<br>
Powered by Octopress.
</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->




	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-53912666-1', 'auto');
	  ga('send', 'pageview');

	</script>



</body>
</html>
